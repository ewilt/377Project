<!DOCTYPE html>

<html>
<head>
  <meta charset="utf-8"/>
  <meta name="author" content=""/>
  <meta name="description" content=""/>
  <title>Prince George's Health Finder</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <link rel="stylesheet" type="text/css" href="styles.css">
</head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
  integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <style>
  .jumbotron {
  background-color: #FF1302
}
  </style>

<body>
  <div class="website-wrapper">
    <section class= "sidebar section-padding">
      <div class="flex-container">
        <!--Logo-->
        <div class="logo-website-wrapper">
          <div class="logo-website">
            <span><a href= "index.html"><img src="WebLogo.png" width= 185 alt="Prince George's Health Finder Logo"></a></span>
          </div>
          <div class="clearfix"></div>
        </div>


        <div class="clearfix"></div>

        <div class= sidebar-menu>
            <textarea id="address_input"></textarea>
            <button type="button" onclick="mMarker(document.getElementById('address_input').value)">Search</button>
            </form>
            <div class="navigation clearfix">
            <div>
              <ul class="menu-list">
                <li><a href="index.html">Navigate</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="hospitals.html">Hospitals</a></li>
                <li><a href="index.html">Documentation</a></li>
                <li><a href="contact.html">Contact Us</a></li>
              </ul>
            </div>
          </div>
        </div>
    </section>

    <section class="content section-padding">
      <div class="container">
        <div id="mapContainer"></div>
      </div>
    </section>
  </div>

  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <script>
    //instantiate leaflet map
    var map = L.map('mapContainer').setView([38.9897, -76.9378], 14);
    //instantiate light map type
    var layer = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/light_all/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attributions">CARTO</a>'
    }).addTo(map);
    //Add marker to map
    L.marker([38.9897, -76.9378]).addTo(map)
    .bindPopup('Your Location')

    // mMarker is used in conjucntion with server post. This function takes the inputted user address, 
    //sends it to the server where it is processed, server sends back latitude and longitude coordinates
    // those coordinates are feed to the address to map fnction with plots the coordinates on the map.
    function mMarker(address){
      
      const data = {address} ;
      const options = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
           },
          body: JSON.stringify(data)
        };
        const response = await fetch('/api',options);
        const json = await response.json();
        address_to_map(json.latitude, json.longitude, "Entered address")
                    }

    async function address_to_map(address){

      latlong = await address_to_latlong(address)
      L.marker([latlong.lat, latlong.lng]).addTo(map).bindPopup("Entered Address")

    }

  </script>
</body>
</html>
